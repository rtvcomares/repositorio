import React, { useState, useEffect } from 'react';
import { 
  BookOpen, 
  PenTool, 
  Mic, 
  Camera, 
  Download, 
  ChevronRight, 
  CheckCircle, 
  ArrowLeft, 
  Send, 
  Sparkles, 
  FileText, 
  Music, 
  HelpCircle,
  Share2
} from 'lucide-react';

export default function App() {
  const [step, setStep] = useState('welcome');
  const [selectedOption, setSelectedOption] = useState(null);
  const [answers, setAnswers] = useState({});
  const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);

  const googleFormUrl = "https://forms.gle/8BRDrCGTU4NEjw2y7";

  const writingQuestions = [
    {
      id: 'topic',
      icon: <BookOpen className="w-6 h-6 text-indigo-500" />,
      question: "¿Título o tema de la actividad?",
      helper: "Ej: Taller de Robótica, Visita al Botánico...",
      placeholder: "Escribe el nombre aquí..."
    },
    {
      id: 'context',
      icon: <Share2 className="w-6 h-6 text-pink-500" />,
      question: "¿Cuándo y dónde?",
      helper: "Ej: 'El pasado viernes en el laboratorio'.",
      placeholder: "El evento tuvo lugar..."
    },
    {
      id: 'participants',
      icon: <Sparkles className="w-6 h-6 text-yellow-500" />,
      question: "¿Quiénes participaron?",
      helper: "Alumnos, profesores, invitados...",
      placeholder: "Acudieron los alumnos de..."
    },
    {
      id: 'objective',
      icon: <HelpCircle className="w-6 h-6 text-blue-500" />,
      question: "¿Cuál era el objetivo?",
      helper: "¿Para qué se hizo? ¿Qué querían aprender?",
      placeholder: "El objetivo principal era..."
    },
    {
      id: 'highlights',
      icon: <FileText className="w-6 h-6 text-emerald-500" />,
      question: "¿Qué actividades hicisteis?",
      helper: "Cuenta los pasos principales.",
      placeholder: "Primero hicimos..., luego..."
    },
    {
      id: 'quotes',
      icon: <Mic className="w-6 h-6 text-orange-500" />,
      question: "¿Frase o anécdota top?",
      helper: "Algo memorable o divertido.",
      placeholder: "Lo más comentado fue..."
    },
    {
      id: 'conclusion',
      icon: <CheckCircle className="w-6 h-6 text-purple-500" />,
      question: "Conclusión final",
      helper: "¿Opinión personal? ¿Repetirías?",
      placeholder: "En definitiva, fue..."
    },
    {
      id: 'multimedia',
      icon: <Camera className="w-6 h-6 text-red-500" />,
      question: "Archivos adjuntos",
      helper: "¿Qué fotos/audios vas a subir?",
      placeholder: "Adjunto fotos de..."
    }
  ];

  const handleStart = () => setStep('menu');

  const handleOptionSelect = (option) => {
    setSelectedOption(option);
    if (option === 'write') {
      setStep('questions');
    } else {
      setStep('direct-upload');
    }
  };

  const handleAnswerChange = (e) => {
    setAnswers({ ...answers, [writingQuestions[currentQuestionIndex].id]: e.target.value });
  };

  const nextQuestion = () => {
    if (currentQuestionIndex < writingQuestions.length - 1) {
      setCurrentQuestionIndex(currentQuestionIndex + 1);
    } else {
      setStep('result');
    }
  };

  const prevQuestion = () => {
    if (currentQuestionIndex > 0) {
      setCurrentQuestionIndex(currentQuestionIndex - 1);
    } else {
      setStep('menu');
    }
  };

  const generateTextContent = () => {
    const title = answers.topic ? answers.topic.toUpperCase() : 'SIN TÍTULO';
    const date = new Date().toLocaleDateString();

    return `BORRADOR DE NOTICIA
=========================================
TÍTULO: ${title}
FECHA: ${date}

INSTRUCCIONES:
Lee, corrige y añade tu estilo personal antes de enviar.

-----------------------------------------
(TITULAR)
${answers.topic}: Una experiencia de aprendizaje fuera del aula

(ENTRADILLA)
${answers.context}, nuestro centro llevó a cabo una actividad muy especial centrada en ${answers.topic}. En esta ocasión, los protagonistas fueron ${answers.participants}.

(CUERPO)
El propósito principal era: ${answers.objective}. Para lograrlo, se organizó una agenda completa. ${answers.highlights}.

(DETALLES)
No faltaron momentos para compartir. ${answers.quotes}.

(CIERRE)
Para cerrar, podemos decir que ${answers.conclusion}.

-----------------------------------------
MULTIMEDIA: ${answers.multimedia}
=========================================`;
  };

  const downloadTxt = () => {
    const element = document.createElement("a");
    const file = new Blob([generateTextContent()], {type: 'text/plain'});
    element.href = URL.createObjectURL(file);
    element.download = `blog_borrador_${Date.now()}.txt`;
    document.body.appendChild(element);
    element.click();
    document.body.removeChild(element);
  };

  // --- COMPONENTES VISUALES ---

  // Fondo animado sutil
  const Background = ({ children }) => (
    <div className="min-h-screen bg-slate-50 relative overflow-hidden font-sans text-slate-800">
      {/* Decorative Orbs */}
      <div className="absolute top-[-10%] left-[-10%] w-96 h-96 bg-purple-200 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob"></div>
      <div className="absolute top-[-10%] right-[-10%] w-96 h-96 bg-yellow-200 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob animation-delay-2000"></div>
      <div className="absolute bottom-[-20%] left-[20%] w-96 h-96 bg-pink-200 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob animation-delay-4000"></div>
      
      <div className="relative z-10 flex flex-col items-center justify-center min-h-screen p-4">
        {children}
      </div>
    </div>
  );

  const Card = ({ children, className = "" }) => (
    <div className={`bg-white/80 backdrop-blur-lg rounded-3xl shadow-2xl border border-white/50 w-full max-w-2xl overflow-hidden ${className}`}>
      {children}
    </div>
  );

  // PANTALLA: BIENVENIDA
  if (step === 'welcome') {
    return (
      <Background>
        <Card className="text-center p-12 transform hover:scale-[1.01] transition-transform duration-500">
          <div className="inline-flex items-center justify-center w-24 h-24 bg-gradient-to-tr from-violet-600 to-indigo-600 rounded-3xl mb-8 shadow-lg shadow-indigo-500/30 rotate-3 hover:rotate-6 transition-transform">
            <BookOpen className="w-12 h-12 text-white" />
          </div>
          <h1 className="text-4xl md:text-5xl font-extrabold bg-clip-text text-transparent bg-gradient-to-r from-violet-600 to-pink-600 mb-4">
            Reporteros Escolares
          </h1>
          <p className="text-lg text-slate-600 mb-10 max-w-md mx-auto leading-relaxed">
            Convierte tus experiencias en noticias increíbles para el blog. 
            Te ayudaré a estructurar tus ideas en minutos.
          </p>
          <button 
            onClick={handleStart}
            className="group relative inline-flex items-center justify-center px-8 py-4 font-bold text-white transition-all duration-200 bg-slate-900 font-lg rounded-2xl hover:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-900 shadow-xl hover:shadow-2xl hover:-translate-y-1"
          >
            <span>Empezar ahora</span>
            <ChevronRight className="w-5 h-5 ml-2 group-hover:translate-x-1 transition-transform" />
          </button>
        </Card>
      </Background>
    );
  }

  // PANTALLA: MENÚ
  if (step === 'menu') {
    return (
      <Background>
        <Card className="p-8">
          <button onClick={() => setStep('welcome')} className="mb-6 text-slate-400 hover:text-slate-600 flex items-center gap-2 text-sm font-medium transition-colors">
            <ArrowLeft size={16} /> Atrás
          </button>
          
          <h2 className="text-3xl font-bold text-slate-800 mb-8 text-center">¿Qué vas a enviar hoy?</h2>
          
          <div className="grid gap-6">
            <button 
              onClick={() => handleOptionSelect('write')}
              className="group flex items-center p-5 bg-white border border-slate-100 rounded-2xl shadow-sm hover:shadow-xl hover:border-violet-200 transition-all duration-300 relative overflow-hidden"
            >
              <div className="absolute inset-0 bg-gradient-to-r from-violet-50 to-white opacity-0 group-hover:opacity-100 transition-opacity" />
              <div className="relative flex items-center gap-6 w-full">
                <div className="w-16 h-16 bg-violet-100 text-violet-600 rounded-2xl flex items-center justify-center group-hover:scale-110 transition-transform duration-300">
                  <PenTool size={32} />
                </div>
                <div className="text-left flex-1">
                  <span className="block text-xl font-bold text-slate-800 group-hover:text-violet-700 transition-colors">Crear Noticia</span>
                  <span className="text-slate-500 text-sm">Te ayudo a escribir el texto paso a paso</span>
                </div>
                <div className="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center group-hover:bg-violet-600 group-hover:text-white transition-colors">
                  <ChevronRight size={18} />
                </div>
              </div>
            </button>

            <button 
              onClick={() => handleOptionSelect('media')}
              className="group flex items-center p-5 bg-white border border-slate-100 rounded-2xl shadow-sm hover:shadow-xl hover:border-pink-200 transition-all duration-300 relative overflow-hidden"
            >
              <div className="absolute inset-0 bg-gradient-to-r from-pink-50 to-white opacity-0 group-hover:opacity-100 transition-opacity" />
              <div className="relative flex items-center gap-6 w-full">
                <div className="w-16 h-16 bg-pink-100 text-pink-600 rounded-2xl flex items-center justify-center group-hover:scale-110 transition-transform duration-300">
                  <Camera size={32} />
                </div>
                <div className="text-left flex-1">
                  <span className="block text-xl font-bold text-slate-800 group-hover:text-pink-700 transition-colors">Solo Fotos / Vídeo</span>
                  <span className="text-slate-500 text-sm">Subir imágenes sin texto largo</span>
                </div>
                 <div className="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center group-hover:bg-pink-600 group-hover:text-white transition-colors">
                  <ChevronRight size={18} />
                </div>
              </div>
            </button>

            <button 
              onClick={() => handleOptionSelect('podcast')}
              className="group flex items-center p-5 bg-white border border-slate-100 rounded-2xl shadow-sm hover:shadow-xl hover:border-amber-200 transition-all duration-300 relative overflow-hidden"
            >
              <div className="absolute inset-0 bg-gradient-to-r from-amber-50 to-white opacity-0 group-hover:opacity-100 transition-opacity" />
              <div className="relative flex items-center gap-6 w-full">
                <div className="w-16 h-16 bg-amber-100 text-amber-600 rounded-2xl flex items-center justify-center group-hover:scale-110 transition-transform duration-300">
                  <Mic size={32} />
                </div>
                <div className="text-left flex-1">
                  <span className="block text-xl font-bold text-slate-800 group-hover:text-amber-700 transition-colors">Podcast / Audio</span>
                  <span className="text-slate-500 text-sm">Subir entrevistas o grabaciones</span>
                </div>
                 <div className="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center group-hover:bg-amber-600 group-hover:text-white transition-colors">
                  <ChevronRight size={18} />
                </div>
              </div>
            </button>
          </div>
        </Card>
      </Background>
    );
  }

  // PANTALLA: CUESTIONARIO (ESCRIBIR)
  if (step === 'questions') {
    const q = writingQuestions[currentQuestionIndex];
    const progress = ((currentQuestionIndex + 1) / writingQuestions.length) * 100;

    return (
      <Background>
        <Card className="flex flex-col min-h-[600px] w-full max-w-2xl">
          {/* Header con Progreso */}
          <div className="px-8 py-6 border-b border-slate-100 bg-slate-50/50">
            <div className="flex justify-between items-end mb-3">
              <span className="text-xs font-bold text-violet-600 tracking-wider uppercase bg-violet-100 px-2 py-1 rounded">Paso {currentQuestionIndex + 1} de {writingQuestions.length}</span>
              <span className="text-xs font-semibold text-slate-400">{Math.round(progress)}%</span>
            </div>
            <div className="h-2 bg-slate-200 rounded-full overflow-hidden">
              <div 
                className="h-full bg-gradient-to-r from-violet-500 to-fuchsia-500 transition-all duration-500 ease-out"
                style={{ width: `${progress}%` }}
              />
            </div>
          </div>

          <div className="flex-1 p-8 flex flex-col justify-center">
            <div className="flex items-center gap-4 mb-6 animate-fadeIn">
              <div className="p-3 bg-slate-100 rounded-xl">
                {q.icon}
              </div>
              <h2 className="text-2xl md:text-3xl font-bold text-slate-800">{q.question}</h2>
            </div>
            
            <div className="relative group">
              <div className="absolute -inset-1 bg-gradient-to-r from-violet-200 to-pink-200 rounded-2xl blur opacity-25 group-focus-within:opacity-75 transition duration-500"></div>
              <textarea
                className="relative w-full p-6 bg-white border-2 border-slate-100 rounded-xl focus:border-violet-500 focus:ring-0 text-lg text-slate-700 placeholder:text-slate-300 resize-none h-48 transition-all shadow-sm"
                placeholder={q.placeholder}
                value={answers[q.id] || ''}
                onChange={handleAnswerChange}
                autoFocus
              />
            </div>

            <div className="mt-6 flex items-start gap-2 text-slate-500 bg-slate-50 p-4 rounded-lg text-sm border border-slate-100">
               <Sparkles className="w-5 h-5 text-yellow-500 flex-shrink-0" />
               <p><span className="font-bold text-slate-700">Consejo:</span> {q.helper}</p>
            </div>
          </div>

          <div className="p-6 border-t border-slate-100 bg-slate-50/50 flex justify-between items-center">
            <button 
              onClick={prevQuestion}
              className="px-6 py-3 text-slate-500 font-bold hover:text-slate-800 transition-colors flex items-center gap-2"
            >
              <ArrowLeft size={20} /> <span className="hidden sm:inline">Anterior</span>
            </button>
            
            <button 
              onClick={nextQuestion}
              disabled={!answers[q.id]}
              className={`flex items-center gap-2 px-8 py-3 rounded-xl font-bold text-white shadow-lg transition-all transform ${
                !answers[q.id] 
                  ? 'bg-slate-300 cursor-not-allowed shadow-none' 
                  : 'bg-slate-900 hover:bg-slate-800 hover:scale-105 hover:shadow-xl'
              }`}
            >
              {currentQuestionIndex === writingQuestions.length - 1 ? 'Finalizar' : 'Siguiente'}
              {currentQuestionIndex === writingQuestions.length - 1 ? <CheckCircle size={20} /> : <ChevronRight size={20} />}
            </button>
          </div>
        </Card>
      </Background>
    );
  }

  // PANTALLA: RESULTADO
  if (step === 'result') {
    return (
      <Background>
        <Card className="w-full max-w-3xl">
          <div className="bg-gradient-to-r from-emerald-500 to-teal-500 p-8 text-center text-white relative overflow-hidden">
             <div className="absolute top-0 left-0 w-full h-full bg-white opacity-10 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]"></div>
             <CheckCircle className="w-16 h-16 mx-auto mb-4 relative z-10 drop-shadow-md" />
             <h2 className="text-3xl font-bold relative z-10">¡Borrador Listo!</h2>
             <p className="opacity-90 relative z-10">Casi has terminado. Sigue estos dos pasos.</p>
          </div>

          <div className="p-8 grid md:grid-cols-2 gap-8">
            {/* Columna Izquierda: Preview */}
            <div className="space-y-4">
              <h3 className="text-xs font-bold text-slate-400 uppercase tracking-widest">Vista Previa</h3>
              <div className="bg-slate-50 p-6 rounded-2xl border border-slate-200 text-sm text-slate-600 h-64 overflow-y-auto font-serif italic shadow-inner custom-scrollbar">
                <p className="mb-2"><strong className="not-italic text-slate-800 sans-serif block mb-1">Título:</strong> {answers.topic || "..."}</p>
                <p>"{answers.context || "..."}..."</p>
                <p className="mt-2 text-xs text-slate-400 text-center">... (Descarga para ver todo) ...</p>
              </div>
            </div>

            {/* Columna Derecha: Acciones */}
            <div className="flex flex-col justify-center space-y-4">
               <div className="bg-blue-50 p-4 rounded-xl flex items-start gap-3">
                  <div className="bg-blue-100 p-2 rounded-lg text-blue-600 font-bold">1</div>
                  <div>
                    <h4 className="font-bold text-blue-900">Descarga tu texto</h4>
                    <p className="text-sm text-blue-700">Guárdalo para copiarlo y pegarlo.</p>
                  </div>
               </div>
               
               <button 
                onClick={downloadTxt}
                className="w-full flex items-center justify-center gap-3 bg-white border-2 border-slate-200 hover:border-slate-800 text-slate-800 font-bold py-3 px-4 rounded-xl transition-all hover:bg-slate-50 group"
              >
                <Download size={20} className="group-hover:translate-y-1 transition-transform" /> Descargar .txt
              </button>

              <div className="h-px bg-slate-100 my-2"></div>

              <div className="bg-indigo-50 p-4 rounded-xl flex items-start gap-3">
                  <div className="bg-indigo-100 p-2 rounded-lg text-indigo-600 font-bold">2</div>
                  <div>
                    <h4 className="font-bold text-indigo-900">Envía el formulario</h4>
                    <p className="text-sm text-indigo-700">Sube tus archivos y pega el texto.</p>
                  </div>
               </div>

              <a 
                href={googleFormUrl}
                target="_blank"
                rel="noopener noreferrer"
                className="w-full flex items-center justify-center gap-3 bg-slate-900 text-white font-bold py-3 px-4 rounded-xl hover:bg-slate-800 transition-all shadow-lg hover:shadow-xl hover:-translate-y-1"
              >
                Ir al Formulario <Send size={18} />
              </a>
            </div>
          </div>
           <button onClick={() => setStep('menu')} className="w-full py-4 bg-slate-50 text-slate-400 hover:text-slate-600 text-sm font-medium border-t border-slate-100 transition-colors">
            Volver al inicio
          </button>
        </Card>
      </Background>
    );
  }

  // PANTALLA: SUBIDA DIRECTA
  if (step === 'direct-upload') {
    const isPodcast = selectedOption === 'podcast';
    const accentColor = isPodcast ? 'text-amber-500' : 'text-pink-500';
    const bgColor = isPodcast ? 'bg-amber-500' : 'bg-pink-500';
    const lightBg = isPodcast ? 'bg-amber-50' : 'bg-pink-50';

    return (
      <Background>
        <Card className="max-w-md">
          <div className={`${bgColor} p-8 text-center text-white`}>
            {isPodcast ? <Music className="w-16 h-16 mx-auto mb-4 animate-bounce" /> : <Camera className="w-16 h-16 mx-auto mb-4 animate-pulse" />}
            <h2 className="text-2xl font-bold">
              {isPodcast ? 'Subir Podcast' : 'Subir Imágenes'}
            </h2>
          </div>
          
          <div className="p-8">
            <h3 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
              <CheckCircle className={`w-5 h-5 ${accentColor}`} /> Checklist Rápido:
            </h3>
            
            <div className="space-y-3 mb-8">
              <div className={`p-4 rounded-xl ${lightBg} flex gap-3 text-sm text-slate-700`}>
                <div className="min-w-[4px] bg-slate-800 rounded-full opacity-20"></div>
                {isPodcast 
                  ? "Revisa que no haya ruido de fondo y las voces se entiendan." 
                  : "Elige solo las 5-10 mejores fotos. ¡Enfoque y luz!"}
              </div>
               <div className={`p-4 rounded-xl ${lightBg} flex gap-3 text-sm text-slate-700`}>
                <div className="min-w-[4px] bg-slate-800 rounded-full opacity-20"></div>
                {isPodcast
                  ? "Ten apuntados los nombres de los entrevistados."
                  : "Prepara un pequeño pie de foto explicando qué se ve."}
              </div>
            </div>

            <a 
              href={googleFormUrl}
              target="_blank"
              rel="noopener noreferrer"
              className={`w-full flex items-center justify-center gap-2 font-bold py-4 px-6 rounded-xl transition shadow-lg text-white hover:-translate-y-1 ${
                isPodcast ? 'bg-amber-500 hover:bg-amber-600' : 'bg-pink-500 hover:bg-pink-600'
              }`}
            >
              Abrir Formulario <Send size={20} />
            </a>
            
            <button onClick={() => setStep('menu')} className="mt-6 text-slate-400 hover:text-slate-600 text-sm w-full text-center">
               Cancelar y volver
            </button>
          </div>
        </Card>
      </Background>
    );
  }

  return null;
}
